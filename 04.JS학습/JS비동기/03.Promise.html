<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>JS비동기 : 3. Promise 사용법</title>
        <script>
            /******************************************************************* 
              [프라미스(Promise)란? "원하는 결과를 보장해! 약속해!"]

                "생성코드"는 시간이 걸릴 수 있는 코드이다.
                "사용코드"는 결과를 기다려야 하는 코드이다.
                Promise는 생성 코드와 소비 코드를 연결하는 JavaScript 객체다!
                __________________________________________________________

                ((구문))
                let 약속변수 = new Promise(function(성공함수, 실패함수) {
                // 생성코드 : 시간이 걸리는 코드

                성공함수(리턴값사용가능); // 성공시호출
                실패함수(리턴값사용가능);  // 에러시 호출
                });

                // 사용코드 : 약속객체가 완료될때까지 기다림!!!
                약속변수.then(
                function(변수) { 성공시코드 },
                function(변수) { 실패시코드 }
                );


         *******************************************************************/
            function 화면뿌려(이거) {
                document.getElementById("show").innerHTML += 이거 + "<br>";
            }

            window.addEventListener("load", () => {
                let 처음약속 = new Promise(function (성공함수, 실패함수) {
                    let x = 0;

                    // 이 자리에 시간이 걸리는 실행코드가 위치함!

                    if (x == 0) {
                        성공함수("성공!!!");
                    } else {
                        실패함수("에러남!!!");
                    }
                });

                처음약속.then(
                    function (value) {
                        화면뿌려(value);
                    },
                    function (error) {
                        화면뿌려(error);
                    }
                );

                //////////////////////////

                let 약속기다림 = new Promise(function (성공함수, myReject) {
                    setTimeout(function () {
                        // 성공함수();
                        성공함수("오마이갓김치!!");
                    }, 3000);
                });

                약속기다림.then(function (value) {
                    화면뿌려("와~~~우!"+value);
                    화면뿌려(`<img src="https://ojsfile.ohmynews.com/STD_IMG_FILE/2014/0103/IE001663873_STD.jpg" style="height:70vh" alt="약속">`);
                });

                // 파일 받기
                let 파일약속 = new Promise(function (성공함수) {
                    let req = new XMLHttpRequest();
                    req.open("GET", "https://tombap8.github.io/FED-PJ-2022-tom/001.HTML%ED%95%99%EC%8A%B5/06.CGV_PJ/001.%EB%B6%84%EC%84%9D%EC%84%A4%EA%B3%84/CGV_Mockup.pdf");
                    req.onload = function () {
                        if (req.status == 200) {
                            성공함수(req.responseURL);
                            // console.log(req.responseURL);
                        } else {
                            실패함수("파일이 존재하지 않습니다~!");
                        }
                    };
                    req.send();
                });

                파일약속.then(
                    function (성공메시지) {
                        화면뿌려("파일로딩완료!",성공메시지);
                        document.getElementById("doc").innerHTML = 
                        `<iframe src="${성공메시지}" style="width:100%;height:100%"></iframe>`;
                    },
                    function (실패메시지) {
                        화면뿌려(실패메시지);
                    }
                );
            }); ////////// load ////////////
        </script>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap");
            body {
                background-image: linear-gradient(to bottom, #494949, gray);
                background-repeat: no-repeat;
                background-attachment: fixed;
                text-align: center;
            }
            #show {
                font-family: "Gamja Flower", cursive;
                font-size: 4vw;
                background-image: linear-gradient(to bottom, lightgreen, pink, orangered, aquamarine);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-repeat: no-repeat;
                font-weight: bold;
            }
            #doc{
                width: 50%;
                height: 50vh;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div id="show"></div>
        <div id="doc"></div>
    </body>
</html>
